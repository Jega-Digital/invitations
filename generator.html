<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Gift Link | Jega Digital</title>
    <!-- Open Graph Data -->
    <meta property="og:title" content="Jega Digital Generator">
    <meta property="og:image" content="https://images.unsplash.com/photo-1605218427306-635ba2439af2?q=80&w=600&auto=format&fit=crop">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lato', sans-serif; background-color: #f8f5f2; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; color: #333; }
        .container { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 400px; width: 90%; text-align: center; margin: 20px 0; position: relative; }
        label { display: flex; justify-content: space-between; align-items: center; text-align: left; font-size: 12px; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; color: #888; letter-spacing: 1px; }
        input, select { width: 100%; padding: 15px; margin-bottom: 20px; border: 2px solid #eee; border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none; }
        input:focus, select:focus { border-color: #333; }
        button.primary-btn { background-color: #333; color: white; border: none; padding: 15px; font-size: 16px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; transition: background 0.3s; }
        button.primary-btn:hover { background-color: #000; }
        #app-interface, #expired-screen { display: none; } 
        .error { color: #d9534f; font-size: 14px; margin-bottom: 15px; display: none; }
        .result-box { margin-top: 30px; display: none; background: #f0f0f0; padding: 20px; border-radius: 10px; text-align: left; }
        .result-link { word-break: break-all; color: #555; font-size: 14px; margin-bottom: 10px; display: block; }
        .timer-text { margin-top: 20px; font-size: 12px; color: #ccc; }

        /* Sign Out Styles */
        .signout-btn {
            position: absolute; top: 10px; right: 10px; 
            background: none; border: none; font-size: 10px; 
            color: #ccc; cursor: pointer; padding: 5px;
        }
        .signout-btn:hover { color: #888; }
        
        /* Gift Code Input Specific Style */
        #giftCodeContainer { margin-bottom: 20px; border: 2px solid #10B981; padding: 15px; border-radius: 10px; background: #e6fff4; display: none; }
    </style>
</head>
<body>

    <!-- SCREEN 1: LOGIN -->
    <div class="container" id="login-screen">
        <h1>ðŸ”’ Restricted Access</h1>
        <p>Enter the Access Code found in your Etsy download.</p>
        <input type="password" id="accessCode" placeholder="Enter Access Code">
        <p class="error" id="loginError">Invalid Code.</p>
        <button class="primary-btn" onclick="checkPass()">Unlock Tool</button>
    </div>

    <!-- SCREEN 2: EXPIRED -->
    <div class="container" id="expired-screen">
        <h1 style="color: #d9534f;">ðŸš« Access Expired</h1>
        <p>Your 30-day access has ended.</p>
        <a href="https://www.etsy.com/shop/YourShopName" target="_blank"><button class="primary-btn">Buy New Pass</button></a>
    </div>

    <!-- SCREEN 3: THE TOOL -->
    <div class="container" id="app-interface">
        <!-- New Sign Out Button -->
        <button class="signout-btn" onclick="signOut()">Sign Out</button>

        <h1>âœ¨ Create Invitation</h1>
        <p style="margin-bottom: 30px; color:#666;">Fill in the details for your card.</p>
        
        <label>Top Title (Optional)</label>
        <input type="text" id="cardTitle" placeholder="e.g. Save the Date">

        <label>Main Message (Required)</label>
        <input type="text" id="cardMessage" placeholder="e.g. We are getting married!">

        <!-- GIFT CODE INPUT -->
        <div id="giftCodeContainer">
            <label for="giftCodeInput" style="color: #10B981;">Gift Card Code (Required for this Card)</label>
            <input type="text" id="giftCodeInput" placeholder="e.g. AMAZON-X93B or 'Gift sent via PayPal'">
        </div>

        <label>Date (Optional)</label>
        <input type="text" id="cardDate" placeholder="e.g. October 26th, 2025">

        <label>Time (Optional)</label>
        <input type="text" id="cardTime" placeholder="e.g. 4:00 PM">

        <label>Location (Optional)</label>
        <input type="text" id="cardLoc" placeholder="e.g. The Plaza Hotel, NYC">

        <button class="primary-btn" onclick="generateLink()">Create Magic Link</button>

        <div id="resultArea" class="result-box">
            <span style="font-size:12px; font-weight:bold; color:#888; text-transform:uppercase;">Your Unique Link:</span>
            <a id="finalLink" class="result-link" href="#" target="_blank"></a>
            <button style="background:white; color:#333; border:1px solid #ddd; padding:10px; width:100%; border-radius:5px; cursor:pointer;" onclick="copyToClipboard()">Copy to Clipboard</button>
        </div>
        <p class="timer-text" id="days-remaining"></p>
    </div>

    <script>
        // --- Jega Digital Product Codes & Security Configuration ---
        const CODES = {
            'GOLD2025': { file: 'card.html', theme: 'Gold Floral', active: true },
            'PURPLE2025': { file: 'card-purple.html', theme: 'Purple Floral', active: true },
            'NAVY2025': { file: 'card-navy.html', theme: 'Navy Luxury', active: true },
            'MEME2025': { file: 'card-67.html', theme: '67 Meme Card (Original)', active: true },
            'SANTA2025': { file: 'card-santa.html', theme: 'Santa 67 Meme', active: true },
            'MONEY2025': { file: 'card-money.html', theme: 'Money 67 Hybrid', active: true, requiresCode: true }
        };
        const ACCESS_DAYS = 30;
        
        // Load API key and check login status on load
        window.onload = function() { 
            if (!checkExpiry()) return;
            if (localStorage.getItem('jega_access_granted') === 'true') {
                showAppInterface();
            }
        };

        // --- SIGN OUT FUNCTION ---
        function signOut() {
            // 1. Clear all authentication and product data
            localStorage.removeItem('jega_start_date');
            localStorage.removeItem('jega_access_granted');
            localStorage.removeItem('jega_card_file');
            
            // 2. Clear any lingering form data
            document.getElementById('accessCode').value = '';
            
            // 3. Reset interface to login screen
            document.getElementById("login-screen").style.display = "block"; 
            document.getElementById("app-interface").style.display = "none"; 
            
            console.log("User successfully signed out.");
        }
        
        function showAppInterface() {
            document.getElementById("login-screen").style.display = "none"; 
            document.getElementById("app-interface").style.display = "block"; 
            checkExpiry(); 
            checkCardRequirement();
        }

        // Checks if the currently logged-in card needs a gift code
        function checkCardRequirement() {
            const cardFile = localStorage.getItem('jega_card_file');
            const codeContainer = document.getElementById('giftCodeContainer');
            
            const currentCode = Object.values(CODES).find(c => c.file === cardFile);
            
            if (currentCode && currentCode.requiresCode) {
                codeContainer.style.display = 'block';
            } else {
                codeContainer.style.display = 'none';
            }
        }

        function checkExpiry() {
            const firstLogin = localStorage.getItem('jega_start_date');
            if (firstLogin) {
                const now = new Date().getTime(); 
                const diffDays = (now - parseInt(firstLogin)) / (1000 * 60 * 60 * 24);
                if (diffDays > ACCESS_DAYS) { 
                    document.getElementById("login-screen").style.display = "none"; 
                    document.getElementById("app-interface").style.display = "none"; 
                    document.getElementById("expired-screen").style.display = "block"; 
                    localStorage.removeItem('jega_access_granted'); 
                    localStorage.removeItem('jega_card_file'); 
                    return false; 
                } else { 
                    document.getElementById("days-remaining").innerText = "License active: " + Math.ceil(ACCESS_DAYS - diffDays) + " days remaining."; 
                    return true; 
                }
            } 
            return true; 
        }

        function checkPass() {
            if (!checkExpiry()) return; 
            const input = document.getElementById("accessCode").value.toUpperCase();
            
            if (CODES[input] && CODES[input].active) { 
                if (!localStorage.getItem('jega_start_date')) {
                    localStorage.setItem('jega_start_date', new Date().getTime());
                }
                
                localStorage.setItem('jega_card_file', CODES[input].file);
                localStorage.setItem('jega_access_granted', 'true');
                
                showAppInterface();
            } else { 
                document.getElementById("loginError").style.display = "block"; 
            }
        }

        function generateLink() {
            const title = document.getElementById("cardTitle").value;
            const msg = document.getElementById("cardMessage").value;
            const date = document.getElementById("cardDate").value;
            const time = document.getElementById("cardTime").value;
            const loc = document.getElementById("cardLoc").value;
            
            const cardFile = localStorage.getItem('jega_card_file') || 'card.html'; 
            const currentCardData = Object.values(CODES).find(c => c.file === cardFile);
            
            if (!msg) { 
                document.getElementById("resultArea").style.display = "none";
                document.getElementById("loginError").innerText = "Please enter a main message!";
                document.getElementById("loginError").style.display = "block";
                return; 
            }

            // --- GIFT CODE CHECK ---
            let giftCode = '';
            if (currentCardData && currentCardData.requiresCode) {
                giftCode = document.getElementById('giftCodeInput').value;
                if (!giftCode) {
                    document.getElementById("resultArea").style.display = "none";
                    document.getElementById("loginError").innerText = "This card requires a Gift Card Code or message!";
                    document.getElementById("loginError").style.display = "block";
                    return;
                }
            }
            // --- END GIFT CODE CHECK ---

            const baseUrl = window.location.origin + "/" + cardFile; 
            let finalUrl = `${baseUrl}?msg=${encodeURIComponent(msg)}`;

            if (title) finalUrl += `&title=${encodeURIComponent(title)}`;
            if (date) finalUrl += `&date=${encodeURIComponent(date)}`;
            if (time) finalUrl += `&time=${encodeURIComponent(time)}`;
            if (loc) finalUrl += `&loc=${encodeURIComponent(loc)}`;
            
            if (giftCode) finalUrl += `&code=${encodeURIComponent(giftCode)}`; 

            const linkDisplay = document.getElementById("finalLink");
            linkDisplay.innerText = finalUrl;
            linkDisplay.href = finalUrl;
            document.getElementById("resultArea").style.display = "block";
            // Clear general error message on success
            document.getElementById("loginError").style.display = "none"; 
        }

        function copyToClipboard() { 
            const linkText = document.getElementById("finalLink").innerText; 
            // Fallback copy method
            const textArea = document.createElement("textarea");
            textArea.value = linkText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            console.log("Link Copied!"); 
        }
        
    </script>
</body>
</html>
